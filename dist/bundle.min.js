angular.module("app",["ui.router","ngCookies"]).config(["$httpProvider",function(t){t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var e=function(t){var a,n,o,r,l,i,s,c="";for(a in t)if(n=t[a],n instanceof Array)for(s=0;s<n.length;++s)l=n[s],o=a+"["+s+"]",i={},i[o]=l,c+=e(i)+"&";else if(n instanceof Object)for(r in n)l=n[r],o=a+"["+r+"]",i={},i[o]=l,c+=e(i)+"&";else void 0!==n&&null!==n&&(c+=encodeURIComponent(a)+"="+encodeURIComponent(n)+"&");return c.length?c.substr(0,c.length-1):c};t.defaults.transformRequest=[function(t){return angular.isObject(t)&&"[object File]"!==String(t)?e(t):t}]}]);var host="http://192.168.1.120/bbter/index.php/Home/",boyslove="isayserious",school=[{name:"请选择",value:""},{name:"C.材料科学与工程学院",value:"材料科学与工程学院"},{name:"D.电子与信息学院",value:"电子与信息学院"},{name:"D.电力学院",value:"电力学院"},{name:"F.法学院(知识产权学院)",value:"法学院(知识产权学院)"},{name:"G.国际教育学院",value:"国际教育学院"},{name:"G.工商管理学院(创业教育学院)",value:"工商管理学院(创业教育学院)"},{name:"G.公共管理学院",value:"公共管理学院"},{name:"H.环境与能源学院",value:"环境与能源学院"},{name:"H.化学与化工学院",value:"化学与化工学院"},{name:"J.机械与汽车工程学院",value:"机械与汽车工程学院"},{name:"J.计算机科学与工程学院",value:"计算机科学与工程学院"},{name:"J.建筑学院",value:"建筑学院"},{name:"J.经济与贸易学院",value:"经济与贸易学院"},{name:"L.理学院(数学系 物理系)",value:"理学院(数学系 物理系)"},{name:"Q.轻工与食品学院",value:"轻工与食品学院"},{name:"R.软件学院",value:"软件学院"},{name:"S.生物科学与工程学院",value:"生物科学与工程学院"},{name:"S.思想政治学院",value:"思想政治学院"},{name:"S.设计学院",value:"设计学院"},{name:"T.土木与交通学院",value:"土木与交通学院"},{name:"T.体育学院",value:"体育学院"},{name:"W.外国语学院",value:"外国语学院"},{name:"X.新闻与传播学院",value:"新闻与传播学院"},{name:"Y.艺术学院",value:"艺术学院"},{name:"Y.医学院",value:"医学院"},{name:"Z.自动化科学与工程学院",value:"自动化科学与工程学院"}],gender=[{name:"请选择",value:""},{name:"男",value:"男"},{name:"女",value:"女"}],dprt=[{name:"所有部门",value:""},{name:"B.编辑部",value:"编辑部"},{name:"C.策划推广部",value:"策划推广部"},{name:"J.技术部",value:"技术部"},{name:"J.节目部",value:"节目部"},{name:"R.人力资源部",value:"人力资源部"},{name:"S.视觉设计部",value:"视觉设计部"},{name:"S.视频部",value:"视频部"},{name:"W.外联部",value:"外联部"},{name:"Z.综合管理部",value:"综合管理部"},{name:"Z.综合新闻部",value:"综合新闻部"}],position=[{name:"所有职位",value:""},{name:"干事",value:"干事"},{name:"主管",value:"主管"},{name:"部长",value:"部长"},{name:"常委",value:"常委"}],superposition=[{name:"干事",value:"干事"},{name:"主管",value:"主管"},{name:"部长",value:"部长"},{name:"常委",value:"常委"},{name:"超级管理员",value:"超级管理员"}];angular.module("app").config(["$stateProvider","$urlRouterProvider",function(t,e){e.when("","/login").when("/user","/user/info").when("/list","/list/all/&&/1").when("/dprt","/dprt/all"),t.state("user",{"abstract":!0,url:"/user",templateUrl:"templates/navi/navi-user.html"}).state("list",{url:"/list","abstract":!0,templateUrl:"templates/navi/navi-list.html"}).state("dprt",{url:"/dprt","abstract":!0,templateUrl:"templates/navi/navi-dprt.html"}).state("login",{url:"/login",templateUrl:"templates/login.html",controller:["$scope","$cookies","userService",function(t,e,a){t.update=function(){var e={};e.studentNo=t.studentNo,e.password=t.password,a.login(e).then(function(t){a.cookieset(t.data.token),a.result(t.data.code)&&(location.href="#/user")})}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("dprt.all",{url:"/all",templateUrl:"templates/department/department-all.html",controller:["$scope","userService","dprtall",function(t,e,a){function n(){a.show().then(function(a){e.cookieset(a.data.token),e.result(a.data.code)&&(t.dprts=a.data.data.dprt,t.editor=a.data.data.editor)})}n(),t.radio={},t.edit=function(){void 0!=t.radio.dprt?location.href="#/dprt/edit/"+t.radio.dprt:alert("请选择对象")},t.isEdit=function(t){return t?!0:!1}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("dprt.add",{url:"/add",templateUrl:"templates/department/department-add.html",controller:["$scope","userService","dprtall",function(t,e,a){t.add=function(){var n={};n.dprtname=t.dprtname,n.dprtnote=t.dprtnote,a.add(n).then(function(t){e.cookieset(t.data.token),e.result(t.data.code)&&(alert("success"),location.href="#/dprt/all")})}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("dprt.edit",{url:"/edit/:id",templateUrl:"templates/department/department-edit.html",controller:["$scope","$stateParams","userService","dprtall",function(t,e,a,n){var o={};o.id=e.id,n.editshow(o).then(function(e){a.cookieset(e.data.token),a.result(e.data.code)&&(t.content=e.data.data,t.dprtname=t.content.dprtname,t.dprtnote=t.content.dprtnote)}),t.edit=function(){var e={};e.id=o.id,e.dprtname=t.dprtname,e.dprtnote=t.dprtnote,n.edit(e).then(function(t){a.cookieset(t.data.token),a.result(t.data.code)&&(alert("success"),location.href="#/dprt/all")})}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("list.all",{url:"/all/:dprt&:position&:keyword/:current",templateUrl:"templates/list/list-all.html",controller:["$scope","$stateParams","listall","userService",function(t,e,a,n){var o=parseInt(e.current);t.dprtopt=dprt,t.positionopt=position,t.dprt=e.dprt,t.position=e.position,t.keyword=e.keyword,t.current=e.current;var r={};r.filter={},r.current=o,r.count=15,r.filter.dprt=e.dprt,r.filter.position=e.position,r.filter.keyword=e.keyword,a.show(r).then(function(e){n.cookieset(e.data.token),n.result(e.data.code)&&(t.members=e.data.data.members,t.total=e.data.data.total,t.editor=e.data.data.editor)}),t.isEdit=function(t){return t?!0:!1},t.filter=function(){location.href="#list/all/"+t.dprt+"&"+t.position+"&"+t.keyword+"/1"},t.reset=function(){location.href="#list/all/&&/1"},t.pagenext=function(){o+1<=t.total?location.href="#list/all/"+t.dprt+"&"+t.position+"&"+t.keyword+"/"+(o+1):alert("last")},t.pageprev=function(){o-1>=1?location.href="#list/all/"+t.dprt+"&"+t.position+"&"+t.keyword+"/"+(o-1):alert("first")}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("list.detail",{url:"/detail/:id",templateUrl:"templates/list/list-detail.html",controller:["$scope","$stateParams","listall","listdprt","userService",function(t,e,a,n,o){function r(){a.detail(e).then(function(e){o.cookieset(e.data.token),o.result(e.data.code)&&(t.content=e.data.data.content,t.editor=e.data.data.editor,t.position=t.content.position)})}t.positionopt=superposition,r(),t.isEdit=function(t){return t?!0:!1},t.changeposition=function(){var a={};a.id=e.id,a.position=t.position,n.position(a).then(function(t){o.cookieset(t.data.token),o.result(t.data.code)&&(alert("success"),r())})}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("list.dprt",{url:"/dprt",templateUrl:"templates/list/list-department.html",controller:["$scope","listdprt","userService",function(t,e,a){function n(){e.show().then(function(e){a.cookieset(e.data.token),a.result(e.data.code)&&(t.members=e.data.data.members,t.editor=e.data.data.editor)})}function o(){var e="";for(x=0;x<t.checkbox.length;x++)null!=t.checkbox[x]&&void 0!=t.checkbox[x].column&&(e=e+t.checkbox[x].column+",",t.checkbox[x]=null);return e=e.substring(0,e.length-1)}t.content={},n(),t.isEdit=function(t){return t?!0:!1},t.checkbox=[],t.rcl="退休",t.position="主管",t.checkbox=[],t.cbcheck=function(){var t=document.getElementsByName("cb");for(x=0;x<t.length;x++)t[x].checked||t[x].click()},t.recheck=function(){var t=document.getElementsByName("cb");for(x=0;x<t.length;x++)t[x].click()},t.decheck=function(){var t=document.getElementsByName("cb");for(x=0;x<t.length;x++)t[x].checked&&t[x].click()},t.recycle=function(){var r={};r.id=o(),""!=r.id?(r.note=t.rcl,e.rcl(r).then(function(t){a.cookieset(t.data.token),a.result(t.data.code)&&(alert("success"),n())})):alert("请选择对象")},t.changeposition=function(){var r={};r.id=o(),""!=r.id?(r.position=t.position,e.position(r).then(function(t){a.cookieset(t.data.token),a.result(t.data.code)&&(alert("success"),n())})):alert("请选择对象")},t.reset=function(){var t=o();""!=t?location.href="#/list/reset/"+t:alert("请选择对象")}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("list.add",{url:"/add",templateUrl:"templates/list/list-add.html",controller:["$scope","listdprt","userService",function(t,e,a){function n(){e.addshow().then(function(e){a.cookieset(e.data.token),a.result(e.data.code)&&(t.uncompleteds=e.data.data.uncompleteds)})}t.position="干事",n(),t.add=function(){var o={};o.studentno=t.studentno,o.position=t.position,e.add(o).then(function(e){function o(t){var a="";for(x=0;x<e.data.data.failed.length;x++)a+=e.data.data.failed[x]+"\r";return a}if(a.cookieset(e.data.token),a.result(e.data.code))alert("success"),location.href="#/list/dprt";else{e.data.data.failed;t.studentno=o(),n()}})}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("list.reset",{url:"/reset/:id",templateUrl:"templates/list/list-resetpw.html",controller:["$scope","$stateParams","listdprt","userService",function(t,e,a,n){var o={};o.id=e.id,a.resetshow(o).then(function(e){n.cookieset(e.data.token),n.result(e.data.code)?t.members=e.data.data.members:history.back()}),t.reset=function(){if(t.newpw==t.cfrmpw){if(window.confirm("确认强制修改密码吗?")){var e={};e.id=o.id,e.pw=t.newpw,e.pwcfrm=t.cfrmpw,a.reset(e).then(function(t){n.cookieset(t.data.token),n.result(t.data.code)&&(alert("success"),location.href="#/list/dprt")})}}else alert("确认密码不一致")}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("list.recycle",{url:"/recycle/:current",templateUrl:"templates/list/list-recycle.html",controller:["$scope","$stateParams","listrcl","userService",function(t,e,a,n){function o(){a.show(i).then(function(e){n.cookieset(e.data.token),n.result(e.data.code)&&(t.members=e.data.data.members,t.total=e.data.data.total)})}function r(){var e="";for(l=0;l<t.checkbox.length;l++)null!=t.checkbox[l]&&void 0!=t.checkbox[l].column&&(e=e+t.checkbox[l].column+",",t.checkbox[l]=null);return e=e.substring(0,e.length-1)}var l=parseInt(e.current);t.current=e.current;var i={};i.current=l,i.count=15,o();var s=document.getElementsByName("cb");t.cbcheck=function(){for(l=0;l<s.length;l++)s[l].checked||s[l].click()},t.recheck=function(){for(l=0;l<s.length;l++)s[l].click()},t.pagenext=function(){l+1<=t.total?location.href="#list/recycle/"+(l+1):alert("last")},t.pageprev=function(){l-1>=1?location.href="#list/recycle/"+(l-1):alert("first")},t.checkbox=[],t.recover=function(){var e={};e.id=r(),""!=e.id?(e.position=t.position,a.recover(e).then(function(t){n.cookieset(t.data.token),n.result(t.data.code)&&(alert("success"),o())})):alert("请选择对象")},t.del=function(){if(window.confirm("此操作将无法撤销,确认彻底删除吗?")){var e={};e.id=r(),""!=e.id&&(e.position=t.position,a.del(e).then(function(t){n.cookieset(t.data.token),n.result(t.data.code)&&(alert("success"),o())}))}else alert("请选择对象")}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("user.pw",{url:"/pwedit",templateUrl:"templates/user/password-edit.html",controller:["$scope","userinfo","userService",function(t,e,a){t.pwedit=function(){if(t.newpw==t.cfrmpw&&t.oldpw!=t.newpw){if(window.confirm("确认修改密码吗?")){var n={};n.old=t.oldpw,n["new"]=t.newpw,n.cfrm=t.cfrmpw,e.password(n).then(function(t){a.cookieset(t.data.token),a.result(t.data.code)&&(alert("success,请重新登录"),a.logout(),location.href="#/login")})}}else t.newpw==t.cfrmpw&&t.oldpw==t.newpw&&alert("新旧密码相同"),t.newpw==t.cfrmpw&&t.oldpw==t.newpw&&alert("确认密码不一致")}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("user.edit",{url:"/infoedit",templateUrl:"templates/user/info-edit.html",controller:["$scope","userinfo","userService",function(t,e,a){e.show().then(function(e){t.genderopt=gender,t.schoolopt=school,a.cookieset(e.data.token),200==e.data.code?(t.content=e.data.data,t.username=t.content.username,t.room=t.content.room,t.telLong=t.content.telLong,t.telShort=t.content.telShort,t.email=t.content.email,t.gender=t.content.gender,t.school=t.content.school):201==e.data.code?(t.gender="",t.school=""):a.result(e.data.code)}),t.infoedit=function(){var n={};n.username=t.username,n.gender=t.gender,n.school=t.school,n.room=t.room,n.telLong=t.telLong,n.telShort=t.telShort,n.email=t.email,e.edit(n).then(function(t){a.cookieset(t.data.token),a.result(t.data.code)&&(alert("success"),location.href="#/user/info")})}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("user.info",{url:"/info",templateUrl:"templates/user/info-detail.html",controller:["$scope","userinfo","userService",function(t,e,a){e.show().then(function(e){a.cookieset(e.data.token),a.result(e.data.code)&&(t.content=e.data.data)})}]})}]),angular.module("app").service("userService",["$http","$cookies",function(t,e){return{login:function(e){var a={};return a.studentno=e.studentNo,a.password=md5(e.password),t.post(host+"Login",a)},logout:function(a){var n=(new Date).getTime(),o=e.get("token"),r=o+"."+n+"."+GibberishAES.enc(o+":"+n,boyslove);t.post(host+"User/logout",r),e.remove("token")},auth:function(){var t=(new Date).getTime(),a=e.get("token"),n=a+"."+t+"."+GibberishAES.enc(a+":"+t,boyslove);return n},cookieset:function(t){var a=new Date;a.setDate(a.getDate()+7);var n=a;return e.put("token",t,{expires:n}),!0},result:function(t){switch(t){case 101:return alert("存在未输入项"),!1;case 103:return alert("账号密码错误"),location.href="#/login",!1;case 104:return alert("宿舍号有误"),!1;case 105:return alert("新旧密码相同"),!1;case 106:return alert("确认密码不一致"),!1;case 107:return alert("旧密码错误"),!1;case 108:return alert("操作对象不能包含自己"),!1;case 200:return!0;case 201:return alert("用户资料未完善"),location.href="#/user/infoedit",!1;case 202:return alert("部分添加成功,未成功条目已在学号框中呈现,请检查输入"),!1;case 302:return alert("账号异常，请重新登录"),location.href="#/login",!1;case 403:return alert("你不具有操作权限"),!1;case 404:return alert("你不具有查看权限"),history.back(),!1;case 500:return alert("未知错误"),!1}}}}]),angular.module("app").service("listall",["$http","userService",function(t,e){return{show:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post(host+"User/listall",n)},detail:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post(host+"User/othersinfo",n)}}}]),angular.module("app").service("listdprt",["$http","userService",function(t,e){return{show:function(){var a={};return a.auth=e.auth(),t.post(host+"User/dprtall",a)},addshow:function(){var a={};return a.auth=e.auth(),t.post(host+"User/getUnCompleted",a)},resetshow:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post(host+"User/pwApply",n)},add:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post(host+"User/batchAdd",n)},rcl:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post(host+"User/rcl",n)},position:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post(host+"User/groupChange",n)},reset:function(a){var n={};return n.data={},n.auth=e.auth(),n.data.id=a.id,n.data.pw=md5(a.pw),n.data.pwcfrm=md5(a.pwcfrm),t.post(host+"User/pwReset",n)}}}]),angular.module("app").service("listrcl",["$http","userService",function(t,e){return{show:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post(host+"User/listRcl",n)},del:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post(host+"User/del",n)},recover:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post(host+"User/recover",n)}}}]),angular.module("app").service("dprtall",["$http","userService",function(t,e){return{show:function(){var a={};return a.auth=e.auth(),t.post(host+"Department/listAll",a)},editshow:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post(host+"Department/detail",n)},edit:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post(host+"Department/edit",n)}}}]),angular.module("app").service("userinfo",["$http","userService",function(t,e){return{show:function(){var a={};return a.auth=e.auth(),t.post(host+"User/info",a)},edit:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post(host+"User/infoEdit",n)},password:function(a){var n={};return n.data={},n.auth=e.auth(),n.data.old=md5(a.old),n.data["new"]=md5(a["new"]),n.data.cfrm=md5(a.cfrm),t.post(host+"User/pwEdit",n)}}}]),angular.module("app").directive("logoutBtn",["userService",function(t){return{restrict:"A",link:function(e,a,n){a.bind("click",function(){t.logout(),location.href="#/login"})}}}]);