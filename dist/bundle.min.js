angular.module("app",["ui.router","ngCookies"]);var boyslove="isayserious",school=[{name:"请选择",value:""},{name:"C.材料科学与工程学院",value:"材料科学与工程学院"},{name:"D.电子与信息学院",value:"电子与信息学院"},{name:"D.电力学院",value:"电力学院"},{name:"F.法学院(知识产权学院)",value:"法学院(知识产权学院)"},{name:"G.国际教育学院",value:"国际教育学院"},{name:"G.工商管理学院(创业教育学院)",value:"工商管理学院(创业教育学院)"},{name:"G.公共管理学院",value:"公共管理学院"},{name:"H.环境与能源学院",value:"环境与能源学院"},{name:"H.化学与化工学院",value:"化学与化工学院"},{name:"J.机械与汽车工程学院",value:"机械与汽车工程学院"},{name:"J.计算机科学与工程学院",value:"计算机科学与工程学院"},{name:"J.建筑学院",value:"建筑学院"},{name:"J.经济与贸易学院",value:"经济与贸易学院"},{name:"L.理学院(数学系 物理系)",value:"理学院(数学系 物理系)"},{name:"Q.轻工与食品学院",value:"轻工与食品学院"},{name:"R.软件学院",value:"软件学院"},{name:"S.生物科学与工程学院",value:"生物科学与工程学院"},{name:"S.思想政治学院",value:"思想政治学院"},{name:"S.设计学院",value:"设计学院"},{name:"T.土木与交通学院",value:"土木与交通学院"},{name:"T.体育学院",value:"体育学院"},{name:"W.外国语学院",value:"外国语学院"},{name:"X.新闻与传播学院",value:"新闻与传播学院"},{name:"Y.艺术学院",value:"艺术学院"},{name:"Y.医学院",value:"医学院"},{name:"Z.自动化科学与工程学院",value:"自动化科学与工程学院"}],gender=[{name:"请选择",value:""},{name:"男",value:"男"},{name:"女",value:"女"}],dprt=[{name:"所有部门",value:""},{name:"B.编辑部",value:"编辑部"},{name:"C.策划推广部",value:"策划推广部"},{name:"J.技术部",value:"技术部"},{name:"J.节目部",value:"节目部"},{name:"R.人力资源部",value:"人力资源部"},{name:"S.视觉设计部",value:"视觉设计部"},{name:"S.视频部",value:"视频部"},{name:"W.外联部",value:"外联部"},{name:"Z.综合管理部",value:"综合管理部"},{name:"Z.综合新闻部",value:"综合新闻部"}],position=[{name:"所有职位",value:""},{name:"干事",value:"干事"},{name:"主管",value:"主管"},{name:"部长",value:"部长"},{name:"常委",value:"常委"}];angular.module("app").config(["$stateProvider","$urlRouterProvider",function(t,e){e.when("","/login").when("/user","/user/info").when("/list","/list/all/&&/1").when("/dprt","/dprt/all"),t.state("user",{"abstract":!0,url:"/user",templateUrl:"templates/navi/navi-user.html"}).state("list",{url:"/list","abstract":!0,templateUrl:"templates/navi/navi-list.html"}).state("dprt",{url:"/dprt","abstract":!0,templateUrl:"templates/navi/navi-dprt.html"}).state("login",{url:"/login",templateUrl:"templates/login.html",controller:["$scope","$cookies","userService",function(t,e,a){t.update=function(){var e={};e.studentNo=t.studentNo,e.password=t.password,a.login(e).then(function(t){a.cookieset(t.data.token),a.result(t.data.code)&&(location.href="#/user")})}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("dprt.all",{url:"/all",templateUrl:"templates/department/department-all.html",controller:["$scope","userService","dprtall",function(t,e,a){a.show().then(function(n){e.cookieset(n.data.token),e.result(n.data.code)&&(t.dprts=n.data.data.dprt),t.radio={},t.edit=function(){location.href="#/dprt/edit/"+t.radio.dprt},t.del=function(){var n={};n.id=t.radio.dprt,a.del(n).then(function(t){e.cookieset(t.data.token),e.result(t.data.code)&&alert("success")})}})}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("dprt.add",{url:"/add",templateUrl:"templates/department/department-add.html",controller:["$scope","userService","dprtall",function(t,e,a){t.add=function(){var n={};n.dprtname=t.dprtname,n.dprtnote=t.dprtnote,a.edit(n).then(function(t){e.cookieset(t.data.token),e.result(t.data.code)&&(alert("success"),location.href="#/dprt/all")})}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("dprt.edit",{url:"/edit/:id",templateUrl:"templates/department/department-edit.html",controller:["$scope","$stateParams","userService","dprtall",function(t,e,a,n){var o={};o.id=e.id,n.editshow(o).then(function(e){a.cookieset(e.data.token),a.result(e.data.code)&&(t.content=e.data.data,t.dprtname=t.content.dprtname,t.dprtnote=t.content.dprtnote)}),t.edit=function(){var e={};e.id=o.id,e.dprtname=t.dprtname,e.dprtnote=t.dprtnote,n.edit(e).then(function(t){a.cookieset(t.data.token),a.result(t.data.code)&&(alert("success"),location.href="#/dprt/all")})}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("list.all",{url:"/all/:dprt&:position&:keyword/:current",templateUrl:"templates/list/list-all.html",controller:["$scope","$stateParams","listall","userService",function(t,e,a,n){var o=parseInt(e.current);t.dprtopt=dprt,t.positionopt=position,t.dprt=e.dprt,t.position=e.position,t.keyword=e.keyword,t.current=e.current;var r={};r.filter={},r.current=o,r.count=15,r.filter.dprt=e.dprt,r.filter.position=e.position,r.filter.keyword=e.keyword,a.show(r).then(function(e){n.cookieset(e.data.token),n.result(e.data.code)&&(t.members=e.data.data.members,t.total=e.data.data.total)}),t.filter=function(){location.href="#list/all/"+t.dprt+"&"+t.position+"&"+t.keyword+"/1"},t.pagenext=function(){o+1<=t.total?location.href="#list/all/"+t.dprt+"&"+t.position+"&"+t.keyword+"/"+(o+1):alert("last")},t.pageprev=function(){o-1>=1?location.href="#list/all/"+t.dprt+"&"+t.position+"&"+t.keyword+"/"+(o-1):alert("first")}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("list.detail",{url:"/detail/:id",templateUrl:"templates/list/list-detail.html",controller:["$scope","$stateParams","listall","userService",function(t,e,a,n){a.detail(e).then(function(e){n.cookieset(e.data.token),n.result(e.data.code)&&(t.content=e.data.data)})}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("list.dprt",{url:"/dprt",templateUrl:"templates/list/list-department.html",controller:["$scope","listdprt","userService",function(t,e,a){function n(){var e="";for(x=0;x<t.checkbox.length;x++)null!=t.checkbox[x]&&(e=e+t.checkbox[x].column+",");return e=e.substring(0,e.length-1)}e.show().then(function(e){a.cookieset(e.data.token),a.result(e.data.code)&&(t.members=e.data.data.members)}),t.checkbox=[],t.rcl="退休",t.position="主管",t.recycle=function(){var o={};o.id=n(),o.note=t.rcl,e.rcl(o).then(function(t){a.cookieset(t.data.token),a.result(t.data.code)&&alert("success")})},t.changeposition=function(){var o={};o.id=n(),o.position=t.position,e.position(o).then(function(t){a.cookieset(t.data.token),a.result(t.data.code)&&alert("success")})},t.reset=function(){var t=n();location.href="#/list/reset/"+t}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("list.add",{url:"/add",templateUrl:"templates/list/list-add.html",controller:["$scope","listdprt","userService",function(t,e,a){t.position="干事",t.add=function(){var n={};n.studentno=t.studentno,n.position=t.position,e.add(n).then(function(t){a.cookieset(t.data.token),a.result(t.data.code)&&(alert("success"),location.href="#/list/dprt")})}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("list.reset",{url:"/reset/:id",templateUrl:"templates/list/list-resetpw.html",controller:["$scope","$stateParams","listdprt","userService",function(t,e,a,n){var o={};o.id=e.id,a.resetshow(o).then(function(e){n.cookieset(e.data.token),n.result(e.data.code)&&(t.members=e.data.data.members)}),t.reset=function(){var e={};e.id=o.id,e.pw=t.pw,e.pwcfrm=t.pwcfrm,a.reset(e).then(function(t){n.cookieset(t.data.token),n.result(t.data.code)&&(alert("success"),location.href="#/list/dprt")})}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("list.recycle",{url:"/recycle/:current",templateUrl:"templates/list/list-recycle.html",controller:["$scope","$stateParams","listrcl","userService",function(t,e,a,n){function o(){var e="";for(r=0;r<t.checkbox.length;r++)null!=t.checkbox[r]&&(e=e+t.checkbox[r].column+",");return e=e.substring(0,e.length-1)}var r=parseInt(e.current);t.current=e.current;var l={};l.current=r,l.count=15,a.show(l).then(function(e){n.cookieset(e.data.token),n.result(e.data.code)&&(t.members=e.data.data.members,t.total=e.data.data.total)}),t.pagenext=function(){r+1<=t.total?location.href="#list/recycle/"+(r+1):alert("last")},t.pageprev=function(){r-1>=1?location.href="#list/recycle/"+(r-1):alert("first")},t.checkbox=[],t.recover=function(){var e={};e.id=o(),e.position=t.position,a.recover(e).then(function(t){n.cookieset(t.data.token),n.result(t.data.code)&&alert("success")})},t.del=function(){var e={};e.id=o(),e.position=t.position,a.del(e).then(function(t){n.cookieset(t.data.token),n.result(t.data.code)&&alert("success")})}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("user.pw",{url:"/pwedit",templateUrl:"templates/user/password-edit.html",controller:["$scope","userinfo","userService",function(t,e,a){t.pwedit=function(){var n={};n.old=t.oldpw,n["new"]=t.newpw,n.cfrm=t.cfrmpw,e.password(n).then(function(t){a.cookieset(t.data.token),a.result(t.data.code)&&(alert("success"),location.href="#/user/info")})}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("user.edit",{url:"/infoedit",templateUrl:"templates/user/info-edit.html",controller:["$scope","userinfo","userService",function(t,e,a){e.show().then(function(e){a.cookieset(e.data.token),a.result(e.data.code)&&(t.content=e.data.data,t.username=t.content.username,t.room=t.content.room,t.telLong=t.content.telLong,t.telShort=t.content.telShort,t.email=t.content.email,t.genderopt=gender,t.gender=t.content.gender,t.schoolopt=school,t.school=t.content.school)}),t.infoedit=function(){var n={};n.username=t.username,n.gender=t.gender,n.school=t.school,n.room=t.room,n.telLong=t.telLong,n.telShort=t.telShort,n.email=t.email,e.edit(n).then(function(t){a.cookieset(t.data.token),a.result(t.data.code)&&(alert("success"),location.href="#/user/info")})}}]})}]),angular.module("app").config(["$stateProvider",function(t){t.state("user.info",{url:"/info",templateUrl:"templates/user/info-detail.html",controller:["$scope","userinfo","userService",function(t,e,a){e.show().then(function(e){a.cookieset(e.data.token),a.result(e.data.code)&&(t.content=e.data.data)})}]})}]),angular.module("app").service("userService",["$http","$cookies",function(t,e){return{login:function(e){var a={};return a.studentNo=e.studentNo,a.password=md5(e.password),t.post("test/get/login.json",a)},logout:function(a){var n=(new Date).getTime(),o=e.get("token"),r=o+"."+n+"."+GibberishAES.enc(o+":"+n,boyslove);t.post("test/get/result.json",r),e.remove("token")},auth:function(){var t=(new Date).getTime(),a=e.get("token"),n=a+"."+t+"."+GibberishAES.enc(a+":"+t,boyslove);return n},cookieset:function(t){var a=new Date;a.setDate(a.getDate()+7);var n=a;return e.put("token",t,{expires:n}),!0},result:function(t){switch(t){case 100:return alert("账号密码错误"),location.href="#/login",!1;case 200:return!0;case 300:return alert("你不具有该权限"),history.back(),!1;case 400:return alert("账号异常，请重新登录"),location.href="#/login",!1;case 500:return alert("未知错误"),!1}}}}]),angular.module("app").service("dprtall",["$http","userService",function(t,e){return{show:function(){var a={};return a.auth=e.auth(),t.post("test/get/dprtAll.json",a)},editshow:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post("test/get/dprtedit.json",n)},edit:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post("test/get/result.json",n)},add:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post("test/get/result.json",n)},del:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post("test/get/result.json",n)}}}]),angular.module("app").service("userinfo",["$http","userService",function(t,e){return{show:function(){var a={};return a.auth=e.auth(),t.post("test/get/userinfo.json",a)},edit:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post("test/get/result.json",n)},password:function(a){var n={};return n.data={},n.auth=e.auth(),n.data.old=md5(a.old),n.data["new"]=md5(a["new"]),n.data.cfrm=md5(a.cfrm),t.post("test/get/result.json",n)}}}]),angular.module("app").service("listall",["$http","userService",function(t,e){return{show:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post("test/get/listAll.json",n)},detail:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post("test/get/listAllDetail.json",n)}}}]),angular.module("app").service("listdprt",["$http","userService",function(t,e){return{show:function(){var a={};return a.auth=e.auth(),t.post("test/get/listDprt.json",a)},resetshow:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post("test/get/listDprtReset.json",n)},add:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post("test/get/result.json",n)},rcl:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post("test/get/result.json",n)},position:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post("test/get/result.json",n)},reset:function(a){var n={};return n.data={},n.auth=e.auth(),n.data.id=a.id,n.data.pw=md5(a.pw),n.data.pwcfrm=md5(a.pwcfrm),t.post("test/get/result.json",n)}}}]),angular.module("app").service("listrcl",["$http","userService",function(t,e){return{show:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post("test/get/listRcl.json",n)},del:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post("test/get/result.json",n)},recover:function(a){var n={};return n.auth=e.auth(),n.data=a,t.post("test/get/result.json",n)}}}]),angular.module("app").directive("logoutBtn",["userService",function(t){return{restrict:"A",link:function(e,a,n){a.bind("click",function(){t.logout(),location.href="#/login"})}}}]);